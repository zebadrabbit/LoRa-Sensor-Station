<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Runtime Configuration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/bootstrap-custom.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="container-fluid">
        <div class="header">
            <h1>âš™ï¸ Runtime Configuration</h1>
            <p>Configure sensor settings remotely via LoRa</p>
        </div>
        
        <!-- Navigation Menu -->
        <div class="nav-menu">
            <a href="/" class="nav-btn">ğŸ“Š Dashboard</a>
            <a href="/client-status" class="nav-btn">ğŸ“‹ Client Status</a>
            <a href="/alerts" class="nav-btn">ğŸ”” Alerts</a>
            <a href="/mqtt" class="nav-btn">ğŸ“¡ MQTT</a>
            <a href="/time" class="nav-btn active">â±ï¸ Time</a>
            <a href="/security" class="nav-btn">ğŸ”’ Security</a>
            <a href="/lora-settings" class="nav-btn">ğŸ“» LoRa Settings</a>
        </div>
        
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div id="sensorInfo">
                <strong style="font-size: 16px;">ğŸ“¡ Configuring Sensor:</strong><br>
                <div style="margin-top: 10px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <div><strong>Location:</strong> <span id="currentLocation">-</span></div>
                    <div><strong>ID:</strong> <span id="currentSensorId">-</span></div>
                    <div><strong>Last Seen:</strong> <span id="lastSeen">-</span></div>
                    <div><strong>Battery:</strong> <span id="battery">-</span>%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">ğŸ“ Sensor Location</div>
                    <div class="card-body">
            <form id="locationForm" role="form" aria-label="Sensor Location Form">
                <fieldset>
                    <div class="row mb-3">
                        <label for="locationInput" class="col-md-4 col-form-label">Sensor Location</label>
                        <div class="col-md-8">
                            <div class="input-group">
                                <span class="input-group-text">ğŸ“</span>
                                <input type="text" class="form-control" id="locationInput" placeholder="e.g., Living Room, Garage, Freezer" maxlength="31" aria-describedby="locationHelp" required>
                            </div>
                            <div id="locationHelp" class="form-text">Maximum 31 characters - descriptive name for this sensor</div>
                        </div>
                    </div>
                </fieldset>
                <div class="row">
                    <div class="col-md-8 offset-md-4">
                        <button type="submit" class="btn btn-primary" id="updateLocationBtn">ğŸ’¾ Update Location</button>
                    </div>
                </div>
            </form>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">â±ï¸ Transmission Interval</div>
                    <div class="card-body">
            <form id="intervalForm" role="form" aria-label="Transmission Interval Form">
                <fieldset>
                    <div class="row mb-3">
                        <label for="intervalInput" class="col-md-4 col-form-label">Interval</label>
                        <div class="col-md-8">
                            <div class="input-group">
                                <span class="input-group-text">â±ï¸</span>
                                <input type="number" class="form-control" id="intervalInput" min="10" max="3600" value="30" aria-describedby="intervalHelp" required>
                                <span class="input-group-text">seconds</span>
                            </div>
                            <div id="intervalHelp" class="form-text">Range: 10 seconds to 1 hour (3600 seconds)</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label class="col-md-4 col-form-label">Quick Presets</label>
                        <div class="col-md-8">
                            <div class="d-flex flex-wrap gap-2" role="group" aria-label="Interval presets">
                                <button type="button" class="btn btn-outline-secondary" onclick="setInterval(10)" aria-label="Set to 10 seconds">10s</button>
                                <button type="button" class="btn btn-outline-secondary" onclick="setInterval(30)" aria-label="Set to 30 seconds">30s</button>
                                <button type="button" class="btn btn-outline-secondary" onclick="setInterval(60)" aria-label="Set to 1 minute">1 min</button>
                                <button type="button" class="btn btn-outline-secondary" onclick="setInterval(300)" aria-label="Set to 5 minutes">5 min</button>
                                <button type="button" class="btn btn-outline-secondary" onclick="setInterval(900)" aria-label="Set to 15 minutes">15 min</button>
                                <button type="button" class="btn btn-outline-secondary" onclick="setInterval(1800)" aria-label="Set to 30 minutes">30 min</button>
                            </div>
                        </div>
                    </div>
                </fieldset>
                <div class="row">
                    <div class="col-md-8 offset-md-4">
                        <button type="submit" class="btn btn-primary" id="updateIntervalBtn">ğŸ’¾ Update Interval</button>
                    </div>
                </div>
            </form>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">ğŸ”„ Sensor Actions</div>
                    <div class="card-body">
            <p>Send commands to the selected sensor</p>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-secondary action-btn" id="restartBtn" onclick="restartSensor()">ğŸ”„ Restart Sensor</button>
                        <button class="btn btn-secondary action-btn" id="pingBtn" onclick="pingSensor()">ğŸ“¡ Request Immediate Ping</button>
                    </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">â„¹ï¸ Information</div>
                    <div class="card-body">
            <p><strong>How it works:</strong> Commands are sent via LoRa to the sensor. The sensor will acknowledge the command in its next transmission.</p>
            <p><strong>Response time:</strong> Sensors with long intervals will temporarily switch to 10-second intervals for 60 seconds after receiving a command, allowing quick responses.</p>
                        <p><strong>No WiFi required:</strong> Sensors don't need WiFi connectivity. All configuration happens over LoRa radio.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const script = document.createElement('script');
            script.src = '/runtime-config.js';
            script.defer = true;
            document.body.appendChild(script);
        });
    </script>
</body>
</html>
